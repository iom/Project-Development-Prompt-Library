{% extends "base.html" %}

{% block content %}
<div class="flex gap-8">
    <!-- Sidebar for categories -->
    <div class="w-1/4">
        <div class="bg-white rounded-lg shadow p-6">
            <h3 class="text-lg font-semibold mb-4">Categories</h3>
            <div id="categories" hx-get="/htmx/categories" hx-trigger="load">
                Loading categories...
            </div>
        </div>
        
        <!-- Disclaimer -->
        <div class="bg-yellow-50 border border-yellow-200 rounded-lg shadow p-4 mt-4">
            <div class="flex items-start">
                <div class="flex-shrink-0">
                    <i class="fas fa-exclamation-triangle text-yellow-600"></i>
                </div>
                <div class="ml-3">
                    <p class="text-sm text-yellow-800 mb-3">
                        Be sure not to upload any sensitive information such as beneficiary information on AI platforms outside of CoPilot.
                    </p>
                    <a href="https://iomint.sharepoint.com/sites/ICTdept/SitePages/IOM-Guidelines-for-the-Ethical-and-Responsible-Use-of-Artificial-Intelligence.aspx?CT=1750840498786&OR=OWA-NT-Mail&CID=4eb0963a-8bcc-ef8a-c59d-f5e708b7df0a&csf=1&web=1&e=7E6WKT" 
                       target="_blank" 
                       class="inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-yellow-800 bg-yellow-100 hover:bg-yellow-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-yellow-500">
                        <i class="fas fa-external-link-alt mr-2"></i>
                        Consult IOM Guidelines for AI Use
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Main content -->
    <div class="flex-1">
        <!-- Search bar -->
        <div class="bg-white rounded-lg shadow p-6 mb-6">
            <div class="flex gap-4">
                <input 
                    type="text" 
                    id="searchQuery"
                    placeholder="Search prompts..." 
                    class="flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                >
                <button 
                    onclick="searchPrompts()" 
                    class="bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700"
                >
                    Search
                </button>
            </div>
        </div>

        <!-- Prompts list -->
        <div id="promptsList" hx-get="/htmx/prompts" hx-trigger="load">
            Loading prompts...
        </div>
    </div>
</div>

<script>
function searchPrompts() {
    const query = document.getElementById('searchQuery').value;
    const params = new URLSearchParams();
    if (query) params.append('query', query);
    
    htmx.ajax('GET', `/htmx/prompts?${params.toString()}`, {target: '#promptsList'});
}

// Handle category selection
function selectCategory(categoryId) {
    const query = document.getElementById('searchQuery').value;
    const params = new URLSearchParams();
    if (query) params.append('query', query);
    if (categoryId) params.append('category', categoryId);
    
    htmx.ajax('GET', `/htmx/prompts?${params.toString()}`, {target: '#promptsList'});
}

// Toggle prompt details
function togglePromptDetails(promptId) {
    const details = document.getElementById(`details-${promptId}`);
    const preview = document.getElementById(`preview-${promptId}`);
    const toggleText = document.getElementById(`toggle-text-${promptId}`);
    
    if (details.classList.contains('hidden')) {
        details.classList.remove('hidden');
        preview.classList.add('hidden');
        toggleText.textContent = 'Hide Details';
    } else {
        details.classList.add('hidden');
        preview.classList.remove('hidden');
        toggleText.textContent = 'View Details';
    }
}

// Copy prompt by ID
function copyPrompt(promptId) {
    fetch(`/api/prompts/${promptId}`)
        .then(response => response.json())
        .then(data => {
            copyToClipboard(data.body);
        })
        .catch(error => console.error('Error fetching prompt:', error));
}
</script>
{% endblock %}